
<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8" />
    <title>弹性绳</title>
    <link rel="icon" type="image/x-icon" href="./images/favicon.ico">
    <style>
        body {
            height: 100%;
           
            margin: 2px;
            user-select: none;
           
        }
        #canvas1 {
            border: 2px solid black;
            cursor: grab;
        }
        .button {
            background: #ff0000;
            border: 1px solid #000000;
            color: #ffffff;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            transition: background 0.3s ease; /* 添加过渡效果 */
        }

            .button:hover {
                background: #ff9900; /* 鼠标悬停时的背景颜色 */
            }

            .button:active {
                background: #ff6600; /* 鼠标点击时的背景颜色 */
            }
        /* 隐藏原始的单选按钮 */
        input[type="radio"] {
            display: none;
        }

            /* 自定义样式的选中状态 */
            input[type="radio"] + label {
                display: inline-block;
                padding: 10px 20px;
                font-size: 16px;
                border-radius: 5px;
                background-color: #eaeaea;
                cursor: pointer;
            }

            /* 选中状态的样式 */
            input[type="radio"]:checked + label {
                background-color: darkblue;
                color: #ffffff;
            }
        input[type="number"] {
            padding: 10px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #ccc;
            outline: none;
        }
        h1 {
            text-align: center;
            font-family: 'LiSu', Arial, sans-serif;
            color: black;
            padding: 20px;
            background-color:aqua
        }
 
    </style>
    <style type="text/css">
        #footer{
            
            bottom:0;
            left:0;
            width:100%;
        }
        #all{
            background-color:antiquewhite;
        }

    </style>
</head>
<body>
    <div id="all">
        <h1 align="center">弹性绳</h1>

        <div align="center"><canvas id="canvas1" width="1200" height="700"></canvas></div>
        <form align="center">
            <i>小球的颜色</i>
            <input type="radio" id="red" name="op" />
            <label for="red">红色</label>

            <input type="radio" id="blue" name="op" />
            <label for="blue">蓝色</label>

            <input type="radio" id="yellow" name="op" />
            <label for="yellow">黄色</label>

            <input type="radio" id="green" name="op" />
            <label for="green">绿色</label>
            <br /><br />
            <label for="num">小球数量：</label>
            <input type="number" id="num" name="num" min="1" max="99"/><i>(注:最好不要超过99，不然会很卡)</i><br /><br />
            是否有弹性：

            <input type="radio" name="choice" id="yes" value=true />
            <label for="yes">是</label>

            <input type="radio" name="choice" id="no" value=false />
            <label for="no">否</label>
            <i>(若要改此选项，请先刷新)</i>
            <br /><br />
            弹性系数：
            <input type="radio" name="k" id="0.05" />
            <label for="0.05">0.05</label>
            <input type="radio" name="k" id="0.01" />
            <label for="0.01">0.01</label>
            <input type="radio" name="k" id="0.1" />
            <label for="0.1">0.1</label>
            <br />
        </form>
        <br />
        <div align="center">
            <button class="button" onclick="run_draw()">确定</button><br />

            <i>
                提示：设置好参数之后，点击确定就会显示出小球
                <br />之后你可以用鼠标自由地拖动它们
                <br />如果设置了弹性，鼠标松开，就会根据拉动的长短以不同的幅度来回运动
            </i>       <br />
            <mark>
                按下“f”键停止<br />
                按下“j”键继续<br />
                按下“回车键”重置
            </mark>
        </div>

        <script>
            var canvas = document.getElementById("canvas1")
            var context = canvas.getContext("2d")
            var ballcolor
            var ballrad = 40
            var ballnum
            var centerX = canvas.width / 2;
            var centerY = canvas.height / 2;
            var k
            function run_draw() {
                var color_array = ["red", "blue", "yellow", "green"];
                var options = document.getElementsByName("op");
                ballnum = parseInt(document.getElementsByName("num")[0].value);
                for (var i = 0; ; i++) {
                    if (options[i].checked == true) {
                        ballcolor = color_array[i];
                        break;
                    }
                }

                var k_arry = [0.05, 0.01, 0.1]
                var ks = document.getElementsByName("k");
                for (var i = 0; ; i++) {
                    if (ks[i].checked) {
                        k = parseFloat(k_arry[i]);//弹性系数
                        break;
                    }
                }
                var choices = document.getElementsByName("choice");
                if (choices[0].checked && choices[0].value === "true") {

                    animate();
                }

                init()
            }

            var balls
            function init() {
                placeballarry = []
                balls = [];
                makeball();
                draw();
                canvas.addEventListener("mousedown", mouseplace)
            }
            function makeball() {
                for (var i = 0; i < ballnum; i++) {
                    ballX = centerX + 200 * Math.cos(2 * Math.PI * i / (ballnum));
                    ballY = centerY + 200 * Math.sin(2 * Math.PI * i / (ballnum));
                    ball = { x: ballX, y: ballY, rad: ballrad, color: ballcolor, vx: 0, vy: 0, ax: 0, ay: 0, ddx: 0, ddy: 0 };
                    balls.push(ball);
                }
            }
            function draw() {
                context.clearRect(0, 0, canvas.width, canvas.height)
                //line
                for (var i = 0; i < ballnum; i++) {
                    context.beginPath();
                    context.moveTo(canvas.width / 2, canvas.height / 2);
                    context.lineTo(balls[i].x, balls[i].y);
                    context.strokeStyle = "red"
                    context.lineWidth = 2
                    context.stroke();
                }
                //ball
                for (var i = 0; i < ballnum; i++) {
                    context.fillStyle = balls[i].color;
                    context.beginPath();
                    context.arc(balls[i].x, balls[i].y, balls[i].rad, 0, 2 * Math.PI);
                    context.fill();
                }
                //center dot
                context.fillStyle = "black"
                context.beginPath();
                context.arc(canvas.width / 2, canvas.height / 2, 5, 0, 2 * Math.PI)
                context.fill()
            }

            var dx, dy
            var placeballarry = []
            function mouseplace(mouse) {


                //mouseup=false
                var canvasplace = canvas.getBoundingClientRect();
                var mouseX = mouse.clientX - canvasplace.left;
                var mouseY = mouse.clientY - canvasplace.top;
                for (var i = 0; i < ballnum; i++) {
                    dx = mouseX - balls[i].x;
                    dy = mouseY - balls[i].y;
                    if (dx * dx + dy * dy < ballrad * ballrad) {
                        placing = true

                        placeball = i
                        break
                    }
                    else {
                        placing = false
                    }
                }
                if (placing) {
                    window.addEventListener("mousemove", mousemovelistener);
                    window.addEventListener("mouseup", mouseuplistener);
                }

            }
            function mousemovelistener(move) {
                var canvasplace = canvas.getBoundingClientRect();
                var mouseX = move.clientX - canvasplace.left;
                var mouseY = move.clientY - canvasplace.top;


                if (mouseX - dx > canvas.width - ballrad) {
                    balls[placeball].x = canvas.width - ballrad
                } else if (mouseX - dx < ballrad) {
                    balls[placeball].x = ballrad
                } else {
                    balls[placeball].x = mouseX - dx
                }
                if (mouseY - dy > canvas.height - ballrad) {
                    balls[placeball].y = canvas.height - ballrad
                } else if (mouseY - dy < ballrad) {
                    balls[placeball].y = ballrad
                } else {
                    balls[placeball].y = mouseY - dy
                }
                draw()
            }
            var mouseup
            function mouseuplistener(up) {
                placeballarry.push(placeball)
                window.removeEventListener("mousemove", mousemovelistener);
                canvas.addEventListener("mousedown", mouseplace)
                mouseup = true
                // placing=false
                window.removeEventListener("mouseup", mouseuplistener)
            }

            function spring() {
                if (mouseup) {
                    for (var i = 0; i < ballnum; i++) {
                        if (placeballarry.includes(i)) {

                            balls[i].ddx = balls[i].x - centerX
                            balls[i].ddy = balls[i].y - centerY
                            if (balls[i].vx > 0) {
                                balls[i].ax = 0 - balls[i].ddx * k
                            } else if (balls[i].vx < 0) {

                                balls[i].ax = 0 - balls[i].ddx * k
                            } else {
                                balls[i].ax = 0 - balls[i].ddx * k
                            }
                            if (balls[i].vy > 0) {
                                balls[i].ay = 0 - balls[i].ddy * k
                            } else if (balls[i].vy < 0) {
                                balls[i].ay = 0 - balls[i].ddy * k
                            } else {
                                balls[i].ay = 0 - balls[i].ddy * k
                            }
                            balls[i].vx = balls[i].vx + balls[i].ax
                            balls[i].vy = balls[i].vy + balls[i].ay
                            balls[i].x = balls[i].x + balls[i].vx
                            balls[i].y = balls[i].y + balls[i].vy

                        }
                    }
                    draw();
                }
            }

            function animate() {
                spring();
                requestAnimationFrame(animate);
            }




            document.addEventListener("keydown", function (event) {
                if (event.key === "f") {
                    mouseup = false;
                }
            });
            document.addEventListener("keydown", function (event) {
                if (event.key === "j") {
                    mouseup = true;
                }
            });

            document.addEventListener("keydown", function (event) {
                if (event.key === "Enter") {
                    mouseup = false
                    init()

                }
            })



        </script>
        <div id="footer">
            <pre>
            <b>致谢</b>
                参考网站：
                         ·W3school:  https//:www.w3school.com.cn
                                 主要是学习html语言，javascript语法
                         ·Stack Overflow(程序设计领域的问答网站):https://stackoverflow.com
                                 https://stackoverflow.com/questions/35827484/html5-canvas-elasticity-animation，对其中问题中的代码的学习，了解到了canvas的基本用法，以及用它画出小球，直线的方法。
                                 https://stackoverflow.com/questions/41613191/how-to-draw-a-curved-spring-in-a-html5-canvas，其中问题中的模拟弹簧的代码，启发了我可以通过不断递归调用绘画函数，更新画板上的图像，从而实现弹性动画效果。
                         ·ChatGPT3.5(主要用来debug)
                感谢助教老师提供的的debug方法：
                          本人累计花费了超过24个小时来完成此网站（<del>包括自学编程知识，构思等，而且由于时间等原因，很多构思都没有实现</del>），很多时间都用在了debug上，<del>（总是要么小球发疯一样乱飞，要么动画效果无法展现）</del>，
                最后用助教说的小黄鸭调试法，顺着代码思路走了一遍，一下找出了好几处问题。
    
            </pre>
        </div>
    </div>

</body>
</html>